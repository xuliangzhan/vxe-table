"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _xeUtils=_interopRequireDefault(require("xe-utils/methods/xe-utils")),_tools=require("../../tools");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function _iterableToArray(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e)){for(var t=0,r=new Array(e.length);t<e.length;t++)r[t]=e[t];return r}}function _defineProperty(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var inputEventTypes=["input","textarea","$input","$textarea"],defaultCompProps={transfer:!0};function parseDate(e,t){return e&&t.valueFormat?_xeUtils.default.toStringDate(e,t.valueFormat):e}function getFormatDate(e,t,r){return _xeUtils.default.toDateString(parseDate(e,t),t.labelFormat||r)}function getEventUpdateType(e){return-1<inputEventTypes.indexOf(e.name)?"input":"change"}function getDefaultComponentName(e){var t=e.name;return"vxe-".concat(t.replace("$",""))}function getNativeAttrs(e){var t=e.name,r=e.attrs;return"input"===t&&(r=Object.assign({type:"text"},r)),r}function getDefaultProps(e,t,r){var n=e.$table,o=t.props;return _xeUtils.default.assign(n.vSize?{size:n.vSize}:{},defaultCompProps,r,o)}function isSyncCell(e,t){return e.immediate||"visible"===e.type||"cell"===t.$type}function getNativeEvents(r,o){var n=r.events,a=o.$table,l=o.row,u=o.column,i=u.model,d=getEventUpdateType(r),e=_defineProperty({},d,function(e){var t=e.target.value;isSyncCell(r,o)?_tools.UtilTools.setCellValue(l,u,t):(i.update=!0,i.value=t),a.updateStatus(o,t),n&&n[d]&&n[d](o,e)});return n?_xeUtils.default.assign({},_xeUtils.default.objectMap(n,function(n){return function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];t=[o].concat(t),n.apply(void 0,_toConsumableArray(t))}}),e):e}function getDefaultEvents(e,o){var r=e.events,n=o.$table,a=getEventUpdateType(e),t=_defineProperty({},a,function(e,t){n.updateStatus(o),r&&r[a]&&r[a](o,t)});return r?_xeUtils.default.assign({},_xeUtils.default.objectMap(r,function(n){return function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];t=[o].concat(t),n.apply(void 0,_toConsumableArray(t))}}),t):t}function nativeEditRender(e,t,r){var n=r.row,o=r.column,a=t.name,l=getNativeAttrs(t),u=isSyncCell(t,r)?_tools.UtilTools.getCellValue(n,o):o.model.value;return[e(a,{class:"vxe-default-".concat(a),attrs:l,domProps:{value:u},on:getNativeEvents(t,r)})]}function defaultEditRender(e,t,r){var n=r.row,o=r.column,a=_tools.UtilTools.getCellValue(n,o),l=getDefaultProps(r,t);return[e(getDefaultComponentName(t),{model:{value:a,callback:function(e){_tools.UtilTools.setCellValue(n,o,e)}},props:l,on:getDefaultEvents(t,r)})]}function defaultButtonEditRender(e,t,r){return[e("vxe-button",{props:getDefaultProps(r,t),on:getDefaultEvents(t,r)})]}function defaultButtonsEditRender(t,e,r){return e.children.map(function(e){return defaultButtonEditRender(t,e,r)[0]})}function renderNativeOptgroups(t,r,n,o){var e=r.optionGroups,a=r.optionGroupProps,l=void 0===a?{}:a,u=l.options||"options",i=l.label||"label";return e.map(function(e){return t("optgroup",{domProps:{label:e[i]}},o(t,e[u],r,n))})}function renderDefaultOptgroups(t,r,n,o){var e=r.optionGroups,a=r.optionGroupProps,l=void 0===a?{}:a,u=l.options||"options",i=l.label||"label";return e.map(function(e){return t("vxe-optgroup",{props:{label:e[i]}},o(t,e[u],r,n))})}function renderNativeOptions(t,e,r,n){var o=r.optionProps,a=void 0===o?{}:o,l=n.row,u=n.column,i=a.label||"label",d=a.value||"value",s=a.disabled||"disabled",p=isSyncCell(r,n)?_tools.UtilTools.getCellValue(l,u):u.model.value;return e.map(function(e){return t("option",{attrs:{value:e[d],disabled:e[s]},domProps:{selected:e[d]==p}},e[i])})}function renderDefaultOptions(t,e,r){var n=r.optionProps,o=void 0===n?{}:n,a=o.label||"label",l=o.value||"value",u=o.disabled||"disabled";return e.map(function(e){return t("vxe-option",{props:{value:e[l],label:e[a],disabled:e[u]}})})}function handleConfirmFilter(e,t,r,n){e.$panel[t.filterMultiple?"changeMultipleOption":"changeRadioOption"]({},r,n)}function getNativeFilterEvents(t,e,o){var r=o.column,n=e.events,a=getEventUpdateType(e),l=_defineProperty({},a,function(e){t.data=e.target.value,handleConfirmFilter(o,r,!!t.data,t),n&&n[a]&&n[a](o,e)});return n?_xeUtils.default.assign({},_xeUtils.default.objectMap(n,function(n){return function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];t=[o].concat(t),n.apply(void 0,_toConsumableArray(t))}}),l):l}function getDefaultFilterEvents(t,e,o){var r=o.column,n=e.events,a=getEventUpdateType(e),l=_defineProperty({},a,function(e){t.data=e.target.value,handleConfirmFilter(o,r,!!t.data,t),n&&n[a]&&n[a](o,e)});return n?_xeUtils.default.assign({},_xeUtils.default.objectMap(n,function(n){return function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];t=[o].concat(t),n.apply(void 0,_toConsumableArray(t))}}),l):l}function nativeFilterRender(t,r,n){var e=n.column,o=r.name,a=getNativeAttrs(r);return e.filters.map(function(e){return t(o,{class:"vxe-default-".concat(o),attrs:a,domProps:{value:e.data},on:getNativeFilterEvents(e,r,n)})})}function defaultFilterRender(e,r,n){var t=n.column,o=getDefaultProps(r,r);return t.filters.map(function(t){return e(getDefaultComponentName(r),{model:{value:t.data,callback:function(e){t.data=e}},props:o,on:getDefaultFilterEvents(t,r,n)})})}function handleFilterMethod(e){var t=e.option,r=e.row,n=e.column,o=t.data;return _xeUtils.default.get(r,n.property)==o}function nativeSelectEditRender(e,t,r){return[e("select",{class:"vxe-default-select",attrs:getNativeAttrs(t),on:getNativeEvents(t,r)},t.optionGroups?renderNativeOptgroups(e,t,r,renderNativeOptions):renderNativeOptions(e,t.options,t,r))]}function defaultSelectEditRender(e,t,r){var n=r.row,o=r.column,a=_tools.UtilTools.getCellValue(n,o),l=getDefaultProps(r,t);return[e(getDefaultComponentName(t),{model:{value:a,callback:function(e){_tools.UtilTools.setCellValue(n,o,e)}},props:l,on:getDefaultEvents(t,r)},t.optionGroups?renderDefaultOptgroups(e,t,r,renderDefaultOptions):renderDefaultOptions(e,t.options,t,r))]}function getSelectCellValue(e,t){var r,n=t.row,o=t.column,a=e.options,l=e.optionGroups,u=e.optionProps,i=void 0===u?{}:u,d=e.optionGroupProps,s=void 0===d?{}:d,p=_xeUtils.default.get(n,o.property),f=i.label||"label",c=i.value||"value";if(l){for(var v=s.options||"options",m=0;m<l.length&&!(r=_xeUtils.default.find(l[m][v],function(e){return e[c]==p}));m++);return r?r[f]:p}return(r=_xeUtils.default.find(a,function(e){return e[c]==p}))?r[f]:p}function getNativeFormEvents(e,o){var r=o.$form,n=o.data,a=o.property,l=e.events,u=getEventUpdateType(e),t=_defineProperty({},u,function(e){var t=e.target.value;_xeUtils.default.set(n,a,t),r.updateStatus(o,t),l&&l[u]&&l[u](o,e)});return l?_xeUtils.default.assign({},_xeUtils.default.objectMap(l,function(n){return function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];t=[o].concat(t),n.apply(void 0,_toConsumableArray(t))}}),t):t}function getDefaultFormEvents(e,o){var n=o.$form,a=e.events,l=getEventUpdateType(e),t=_defineProperty({},l,function(e,t){var r=e.value;n.updateStatus(o,r),a&&a[l]&&a[l](o,t)});return a?_xeUtils.default.assign({},_xeUtils.default.objectMap(a,function(n){return function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];t=[o].concat(t),n.apply(void 0,_toConsumableArray(t))}}),t):t}function getDefaultFormItemProps(e,t,r){var n=e.$form,o=t.props;return _xeUtils.default.assign(n.vSize?{size:n.vSize}:{},defaultCompProps,r,o)}function nativeItemRender(e,t,r){var n=r.data,o=r.property,a=t.name,l=getNativeAttrs(t),u=_xeUtils.default.get(n,o);return[e(a,{class:"vxe-default-".concat(a),attrs:l,domProps:!l||"input"!==a||"submit"!==l.type&&"reset"!==l.type?{value:u}:null,on:getNativeFormEvents(t,r)})]}function defaultItemRender(e,t,r){var n=r.data,o=r.property,a=_xeUtils.default.get(n,o),l=getDefaultFormItemProps(r,t);return[e(getDefaultComponentName(t),{model:{value:a,callback:function(e){_xeUtils.default.set(n,o,e)}},props:l,on:getDefaultFormEvents(t,r)})]}function defaultButtonItemRender(e,t,r){return[e("vxe-button",{props:getDefaultFormItemProps(r,t),on:getDefaultFormEvents(t,r)})]}function defaultButtonsItemRender(t,e,r){return e.children.map(function(e){return defaultButtonItemRender(t,e,r)[0]})}function renderNativeFormOptions(r,e,t,n){var o=n.data,a=n.property,l=t.optionProps,u=void 0===l?{}:l,i=u.label||"label",d=u.value||"value",s=u.disabled||"disabled",p=_xeUtils.default.get(o,a);return e.map(function(e,t){return r("option",{attrs:{value:e[d],disabled:e[s]},domProps:{selected:e[d]==p},key:t},e[i])})}function createExportMethod(t,e){var r=e?"editRender":"cellRender";return function(e){return t(e.column[r],e)}}function defaultFormItemRadioAndCheckboxRender(t,e,r){var n=e.options,o=e.optionProps,a=void 0===o?{}:o,l=r.data,u=r.property,i=a.label||"label",d=a.value||"value",s=a.disabled||"disabled",p=_xeUtils.default.get(l,u),f=getDefaultFormItemProps(r,e),c=getDefaultComponentName(e);return[t("".concat(c,"-group"),{props:f,model:{value:p,callback:function(e){_xeUtils.default.set(l,u,e)}},on:getDefaultFormEvents(e,r)},n.map(function(e){return t(c,{props:{label:e[d],content:e[i],disabled:e[s]}})}))]}var renderMap={input:{autofocus:"input",renderEdit:nativeEditRender,renderDefault:nativeEditRender,renderFilter:nativeFilterRender,filterMethod:handleFilterMethod,renderItem:nativeItemRender},textarea:{autofocus:"textarea",renderEdit:nativeEditRender,renderDefault:nativeEditRender,renderFilter:nativeFilterRender,filterMethod:handleFilterMethod,renderItem:nativeItemRender},select:{renderEdit:nativeSelectEditRender,renderDefault:nativeSelectEditRender,renderCell:function(e,t,r){return getSelectCellValue(t,r)},renderFilter:function(t,r,n){return n.column.filters.map(function(e){return t("select",{class:"vxe-default-select",attrs:getNativeAttrs(r),on:getNativeFilterEvents(e,r,n)},r.optionGroups?renderNativeOptgroups(t,r,n,renderNativeOptions):renderNativeOptions(t,r.options,r,n))})},filterMethod:handleFilterMethod,renderItem:function(e,t,r){return[e("select",{class:"vxe-default-select",attrs:getNativeAttrs(t),on:getNativeFormEvents(t,r)},t.optionGroups?renderNativeOptgroups(e,t,r,renderNativeFormOptions):renderNativeFormOptions(e,t.options,t,r))]},editCellExportMethod:createExportMethod(getSelectCellValue,!0),cellExportMethod:createExportMethod(getSelectCellValue)},$input:{autofocus:".vxe-input--inner",renderEdit:defaultEditRender,renderCell:function(e,t,r){var n=t.props,o=void 0===n?{}:n,a=r.row,l=r.column,u=_xeUtils.default.get(a,l.property);switch(o.type){case"date":u=getFormatDate(u,o,"yyyy-MM-dd");break;case"month":u=getFormatDate(u,o,"yyyy-MM");break;case"year":u=getFormatDate(u,o,"yyyy")}return u},renderDefault:defaultEditRender,renderFilter:defaultFilterRender,filterMethod:handleFilterMethod,renderItem:defaultItemRender},$button:{renderEdit:defaultButtonEditRender,renderDefault:defaultButtonEditRender,renderItem:defaultButtonItemRender},$buttons:{renderEdit:defaultButtonsEditRender,renderDefault:defaultButtonsEditRender,renderItem:defaultButtonsItemRender},$select:{renderEdit:defaultSelectEditRender,renderDefault:defaultSelectEditRender,renderCell:function(e,t,r){return getSelectCellValue(t,r)},renderFilter:function(e,r,n){var t=n.column,o=getDefaultProps(n,r);return t.filters.map(function(t){return e(getDefaultComponentName(r),{model:{value:t.data,callback:function(e){t.data=e}},props:o,on:getDefaultFilterEvents(t,r,n)},r.optionGroups?renderDefaultOptgroups(e,r,n,renderDefaultOptions):renderDefaultOptions(e,r.options,r,n))})},filterMethod:handleFilterMethod,renderItem:function(e,t,r){var n=r.data,o=r.property,a=_xeUtils.default.get(n,o),l=getDefaultFormItemProps(r,t);return[e(getDefaultComponentName(t),{model:{value:a,callback:function(e){_xeUtils.default.set(n,o,e)}},props:l,on:getDefaultFormEvents(t,r)},t.optionGroups?renderDefaultOptgroups(e,t,r,renderDefaultOptions):renderDefaultOptions(e,t.options,t,r))]},editCellExportMethod:createExportMethod(getSelectCellValue,!0),cellExportMethod:createExportMethod(getSelectCellValue)},$radio:{renderItem:defaultFormItemRadioAndCheckboxRender},$checkbox:{renderItem:defaultFormItemRadioAndCheckboxRender}},renderer={mixin:function(e){return _xeUtils.default.each(e,function(e,t){return renderer.add(t,e)}),renderer},get:function(e){return renderMap[e]||null},add:function(e,t){if(e&&t){var r=renderMap[e];r?Object.assign(r,t):renderMap[e]=t}return renderer},delete:function(e){return delete renderMap[e],renderer}},_default=renderer;exports.default=_default;